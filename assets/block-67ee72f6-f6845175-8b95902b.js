var u=Object.defineProperty,v=(e,t,s)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,i=(e,t,s)=>(v(e,typeof t!="symbol"?t+"":t,s),s);class y{constructor(t,s){i(this,"template",""),i(this,"style",""),this.template=t,this.style=s}compile(t,s={}){var n;const h=/\{\{.*?\}\}/g;let o=this.template;(n=this.template.match(h))==null||n.forEach(c=>{const a=c.replaceAll(/\{\{ | \}\}/g,""),r=t[a];r&&typeof r=="string"&&(o=o.replaceAll(c,r))});const m=document.createElement("div");m.innerHTML=o;const p=m.firstElementChild;return Object.keys(s).forEach(c=>{const a=p.querySelectorAll(c.toLowerCase());a.length&&a.forEach(r=>{var E;const _=s[c];_.classList.add(...r.classList.values()),(E=r.parentNode)==null||E.insertBefore(_,r),r.remove()})}),{template:p,style:this.style}}}class f{constructor(){i(this,"listeners"),this.listeners={}}on(t,s){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(s)}off(t,s){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t]=this.listeners[t].filter(n=>n!==s)}emit(t,...s){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t].forEach(function(n){n(...s)})}}const l=class{constructor(e="div",t={},s,n){i(this,"_element"),i(this,"_templateEngine"),i(this,"_meta"),i(this,"events"),i(this,"props"),i(this,"eventBus"),i(this,"components"),i(this,"setProps",o=>{o&&Object.assign(this.props,o)});const h=new f;this._meta={tagName:e,props:t},this._templateEngine=new y(s,n),l._style=n,this.props=this._makePropsProxy(t),this.eventBus=()=>h,this._registerEvents(h),h.emit(l.EVENTS.INIT)}_removeEvents(){let e=[];this.events&&(e=Object.keys(this.events)),e.forEach(t=>{var s;const n=(s=this.events)==null?void 0:s[t];this._element&&n&&this._element.removeEventListener(t,n)})}_addEvents(){const{events:e}=this.props;if(!e)return;const t=Object.keys(e);this.events=e,t.forEach(s=>{const n=e==null?void 0:e[s];this._element&&n&&this._element.addEventListener(s,n)})}initComponents(e){this.components=e}_registerEvents(e){e.on(l.EVENTS.INIT,this.init.bind(this)),e.on(l.EVENTS.FLOW_RENDER,this._render.bind(this))}_createResources(){const{tagName:e}=this._meta;this._element=this._createDocumentElement(e)}init(){this._createResources()}componentDidUpdate(e,t){return e===t}get element(){return this._render(),this._element}_render(){this._removeEvents();const e=this.render();this._element&&(this._element.innerHTML="",this._element.append(e.template),this._addEvents())}render(){return this._templateEngine.compile(this.props,this.components)}getContent(){return this.element}static getStyles(){return this._style}_makePropsProxy(e){return new Proxy(e,{set:(t,s,n)=>(t[s]=n,this.eventBus().emit(l.EVENTS.FLOW_RENDER),!0),deleteProperty(){throw new Error("нет доступа")}})}_createDocumentElement(e){return document.createElement(e)}show(){const e=this.getContent();e&&(e.style.display="block")}hide(){const e=this.getContent();e&&(e.style.display="none")}};let d=l;i(d,"_style"),i(d,"EVENTS",{INIT:"init",FLOW_CDM:"flow:component-did-mount",FLOW_RENDER:"flow:render",FLOW_CDU:"flow:component-did-update"});export{d};
